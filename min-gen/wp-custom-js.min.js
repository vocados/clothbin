const prefix='clothbin';let sidoToDest={};const loadMap=()=>{let map=new naver.maps.Map('map',{zoom:12,zoomControl:true,zoomControlOptions:{position:naver.maps.Position.TOP_RIGHT}});let markers=[];let bounds=new naver.maps.LatLngBounds();let infoWindow=new naver.maps.InfoWindow({content:''});for(let row of data){let position=new naver.maps.LatLng(row.lat,row.lng);let marker=new naver.maps.Marker({map:map,position:position,});bounds.extend(position);markers.push(marker);if(row.title){naver.maps.Event.addListener(marker,'click',function(){infoWindow.setContent('<div>'+row.title+'</div>');infoWindow.open(map,marker);});}}
map.fitBounds(bounds);}
const simpleFetch=(url,callBack)=>{fetch(url).then(response=>{if(!response.ok){throw new Error("JSON 데이터를 불러오는 중 문제가 발생했습니다.");}
return response.json();}).then(jsonData=>{callBack(jsonData);}).catch(error=>{callBack();});}
const getCenter=(coordinates)=>{let totalLat=0;let totalLng=0;coordinates.forEach(coord=>{totalLat+=coord.lat;totalLng+=coord.lng;});const centerLat=totalLat/coordinates.length;const centerLng=totalLng/coordinates.length;return{lat:centerLat,lng:centerLng};}
document.addEventListener("DOMContentLoaded",()=>{if(window.location.pathname.startsWith("/location")&&data){loadMap()}
const shareBtn=document.getElementById('share-btn');if(shareBtn){shareBtn.addEventListener('click',function(){const url=window.location.href;if(navigator.share){navigator.share({url:url}).then(()=>{console.log('공유 성공');}).catch((error)=>{console.error('공유 실패:',error);});}
else{navigator.clipboard.writeText(url).then(()=>{alert('URL이 클립보드에 복사되었습니다.');}).catch((error)=>{console.error('클립보드 복사 실패:',error);alert('URL 복사 실패. 수동으로 복사해 주세요.');});}});}});if(window.location.pathname=="/"||window.location.pathname==""){const jsonUrl=`/wp-content/${prefix}/sido.json`;simpleFetch(jsonUrl,(data)=>{const citySelect=document.getElementById('city');const gugunSelect=document.getElementById('gugun');if(citySelect){Object.entries(data).forEach(([name])=>{const option=document.createElement('option');option.value=name;option.textContent=name;citySelect.appendChild(option);});}
document.addEventListener('change',(event)=>{if(event.target&&event.target.id==='city'){const city=event.target.value;gugunSelect.innerHTML='<option value="">구군을 선택해주세요</option>';if(city&&data[city]){const guguns=Object.keys(data[city]);guguns.sort((a,b)=>a.localeCompare(b,'ko')).forEach(gugun=>{const option=document.createElement('option');option.value=gugun;option.textContent=gugun;gugunSelect.appendChild(option);});}}
else if(event.target&&event.target.id==='gugun'){const city=citySelect.value;const gugun=gugunSelect.value;const buttonContainer=document.getElementById("main-content");if(city&&gugun){const jsonUrl=`/wp-content/clothbin/sido-to-dest.json`;simpleFetch(jsonUrl,(destData)=>{buttonContainer.innerHTML='';const key=`${city}-${gugun}`.replace(" ","-");if(destData[key]){Object.entries(destData[key]).forEach(([dong,url])=>{const button=document.createElement('button');button.textContent=dong;button.onclick=()=>{window.location.href=url;};button.style.marginRight='0.3em';button.style.marginBottom='0.3em';button.style.borderRadius='22px';buttonContainer.appendChild(button);});}});}}
else if(event.target&&event.target.id==='dong'){}});});}